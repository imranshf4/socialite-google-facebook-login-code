1ï¸âƒ£ AuditLog Table (Final Structure)
Schema::create('audit_logs', function (Blueprint $table) {
    $table->id();

    // Who did the action
    $table->unsignedBigInteger('actor_id')->nullable();
    $table->string('actor_type')->nullable();

    // What was affected
    $table->unsignedBigInteger('auditable_id')->nullable();
    $table->string('auditable_type')->nullable();

    $table->string('action');
    $table->json('old_values')->nullable();
    $table->json('new_values')->nullable();

    $table->timestamps();
});

2ï¸âƒ£ AuditLog Model
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class AuditLog extends Model
{
    protected $fillable = [
        'actor_id',
        'actor_type',
        'auditable_id',
        'auditable_type',
        'action',
        'old_values',
        'new_values',
    ];

    protected $casts = [
        'old_values' => 'array',
        'new_values' => 'array',
    ];

    // ğŸ”¹ Admin / User / System
    public function actor()
    {
        return $this->morphTo();
    }

    // ğŸ”¹ Order / Product / User
   // Order / Product / User
    public function auditable()
    {
        return $this->morphTo()->constrain([
            Order::class => function ($query) {
                $query->select('id', 'invoice_no', 'status');
            },
        ]);
    }
}

3ï¸âƒ£ Admin & User Model à¦ Relation
Admin Model
class Admin extends Model
{
    public function auditLogs()
    {
        return $this->morphMany(AuditLog::class, 'actor');
    }
}

User Model
class User extends Model
{
    public function auditLogs()
    {
        return $this->morphMany(AuditLog::class, 'actor');
    }
}


â¡ à¦à¦–à¦¨:

$admin->auditLogs;
$user->auditLogs;

4ï¸âƒ£ Order / Product Model à¦ Relation
Order Model
class Order extends Model
{
    public function auditLogs()
    {
        return $this->morphMany(AuditLog::class, 'auditable');
    }
}

Product Model
class Product extends Model
{
    public function auditLogs()
    {
        return $this->morphMany(AuditLog::class, 'auditable');
    }
}


â¡ à¦à¦–à¦¨:

$order->auditLogs;
$product->auditLogs;

5ï¸âƒ£ Audit Log Create à¦•à¦°à¦¾à¦° à¦¸à¦ à¦¿à¦• à¦‰à¦ªà¦¾à§Ÿ
Admin Order Update à¦•à¦°à¦²à§‡
AuditLog::create([
    'actor_id' => auth('admin')->id(),
    'actor_type' => Admin::class,

    'auditable_id' => $order->id,
    'auditable_type' => Order::class,

    'action' => 'order_status_updated',
    'old_values' => ['status' => 'pending'],
    'new_values' => ['status' => 'shipped'],
]);

User Profile Update à¦•à¦°à¦²à§‡
AuditLog::create([
    'actor_id' => auth()->id(),
    'actor_type' => User::class,

    'auditable_id' => auth()->id(),
    'auditable_type' => User::class,

    'action' => 'profile_updated',
]);

6ï¸âƒ£ Relation à¦¬à§à¦¯à¦¬à¦¹à¦¾à¦° à¦•à¦°à§‡ Data à¦ªà§œà¦¾
Audit Log â†’ Actor
$log = AuditLog::first();

$log->actor;      // Admin / User object
$log->auditable;  // Order / Product object

Order â†’ Audit Logs
$order = Order::find(5);
$order->auditLogs;

Admin â†’ Audit Logs
$admin = Admin::find(1);
$admin->auditLogs;

7ï¸âƒ£ Important Best Practice âš ï¸
âŒ à¦à¦Ÿà¦¾ à¦•à¦°à§‹ à¦¨à¦¾
actor_type = "admin"

âœ… à¦à¦Ÿà¦¾ à¦•à¦°à§‹
actor_type = Admin::class
auditable_type = Order::class


â¡ Laravel automatically resolve à¦•à¦°à¦¬à§‡à¥¤



######################
system 2
###########################
$newValue = [
                'status' => $order->invoice_no
            ];
            AuditLogService::log(
                session()->get('admin')['id'],
'order'
                $order,
                'Order created',
                null,
                $newValue
            );